{"ast":null,"code":"var _jsxFileName = \"/home/miltonejones/projects/react-sploosh-amplify/src/components/VideoCollection/VideoCollection.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from 'react';\nimport useComponentState from '../../hooks/useComponentState';\nimport { getVideos, getVideo, findVideos } from '../../connector/DbConnector';\nimport { VideoCard, ModelModal, useModelModal, Flex, StyledPagination } from '../';\nimport { TextField, Box, Button } from '@mui/material';\nimport './VideoCollection.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function VideoCollection(props) {\n  _s();\n\n  const {\n    setBusy,\n    response,\n    pageNum,\n    handleChange,\n    modelModalState,\n    showDialog,\n    busy,\n    searchParam,\n    searchKey\n  } = useVideoCollection(props);\n  const {\n    count,\n    records\n  } = response;\n  if (!records) return 'Loading...';\n  const totalPages = Math.ceil(count / 30);\n  return /*#__PURE__*/_jsxDEV(Box, {\n    className: \"VideoCollection\",\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      className: \"head\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        children: [\"[\", pageNum, \"][[\", searchParam, \"]][\", searchKey, \"][\", response.searchKey, \"]\", /*#__PURE__*/_jsxDEV(StyledPagination, {\n          totalPages: totalPages,\n          page: pageNum,\n          handleChange: handleChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 34,\n          columnNumber: 11\n        }, this), !!busy && /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 39,\n          columnNumber: 22\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 32,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: \"App\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ThumbnailGrid\",\n        children: records === null || records === void 0 ? void 0 : records.map(video => /*#__PURE__*/_jsxDEV(VideoCard, {\n          video: video,\n          getModel: q => {\n            showDialog(q);\n          }\n        }, video.ID, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 43,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: \"head\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        children: /*#__PURE__*/_jsxDEV(StyledPagination, {\n          totalPages: totalPages,\n          page: pageNum,\n          handleChange: handleChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModelModal, { ...modelModalState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 30,\n    columnNumber: 5\n  }, this);\n}\n\n_s(VideoCollection, \"OmiICZkzSYPZw1mns22frgabUjs=\", false, function () {\n  return [useVideoCollection];\n});\n\n_c = VideoCollection;\n\nfunction useVideoCollection(_ref) {\n  _s2();\n\n  let {\n    collectionType,\n    searchParam,\n    pageNum,\n    onChange,\n    setBusy\n  } = _ref;\n  const {\n    state,\n    setState\n  } = useComponentState({\n    page: 1,\n    param: searchParam,\n    type: collectionType,\n    response: {},\n    searchKey: `${collectionType}-${searchParam}-${pageNum}`\n  });\n  const {\n    modelModalState,\n    showDialog\n  } = useModelModal();\n  const {\n    page,\n    response,\n    busy,\n    type,\n    param,\n    searchKey\n  } = state;\n\n  const createKey = () => [collectionType, searchParam, pageNum].filter(f => !!f).join('-');\n\n  const handleChange = (event, value) => {\n    const href = onChange && onChange(value);\n  };\n\n  const loadVideos = React.useCallback(async p => {\n    const items = await getVideos(p);\n    const searchKey$ = `video-${p}`;\n    console.log({\n      items\n    });\n    setState('response', { ...items,\n      searchKey: searchKey$\n    });\n    setState('page', p);\n    setState('searchKey', searchKey$);\n  }, [page]);\n  const searchVideos = React.useCallback(async (str, p) => {\n    const items = await findVideos(str, p);\n    const searchKey$ = `search-${str}-${p}`;\n    console.log({\n      items\n    });\n    setState('response', { ...items,\n      searchKey: searchKey$\n    });\n    setState('page', p);\n    setState('param', str);\n    setState('searchKey', searchKey$);\n  }, [page]);\n  const load = React.useCallback(async (p, t) => {\n    setState('busy', !0);\n    setBusy(!0);\n\n    switch (collectionType) {\n      case 'search':\n        await searchVideos(searchParam, p);\n        break;\n\n      default:\n        await loadVideos(p);\n    }\n\n    setState('type', t);\n    setState('busy', !1);\n    setBusy(!1);\n  }, [collectionType]);\n  React.useEffect(() => {\n    const renew = searchKey !== createKey();\n    console.log({\n      pageNum,\n      page,\n      searchKey\n    }, [createKey(), response.searchKey, renew.toString()]);\n    (!!renew || !response.records) && load(pageNum, collectionType);\n  }, [response, pageNum, page, collectionType, type, param, searchParam]); // const { count, records } = response;\n  // if (!records) return 'Loading...';\n  // const totalPages = Math.ceil(count / 30);\n\n  return {\n    response,\n    searchParam,\n    pageNum,\n    handleChange,\n    modelModalState,\n    showDialog,\n    busy,\n    setBusy,\n    searchKey\n  };\n}\n\n_s2(useVideoCollection, \"t/jbVDWJyZ7uUlkDgF5dGC82H5c=\", false, function () {\n  return [useComponentState, useModelModal];\n});\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoCollection\");","map":{"version":3,"sources":["/home/miltonejones/projects/react-sploosh-amplify/src/components/VideoCollection/VideoCollection.js"],"names":["React","useComponentState","getVideos","getVideo","findVideos","VideoCard","ModelModal","useModelModal","Flex","StyledPagination","TextField","Box","Button","VideoCollection","props","setBusy","response","pageNum","handleChange","modelModalState","showDialog","busy","searchParam","searchKey","useVideoCollection","count","records","totalPages","Math","ceil","map","video","q","ID","collectionType","onChange","state","setState","page","param","type","createKey","filter","f","join","event","value","href","loadVideos","useCallback","p","items","searchKey$","console","log","searchVideos","str","load","t","useEffect","renew","toString"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport useComponentState from '../../hooks/useComponentState';\r\nimport { getVideos, getVideo, findVideos } from '../../connector/DbConnector';\r\nimport {\r\n  VideoCard,\r\n  ModelModal,\r\n  useModelModal,\r\n  Flex,\r\n  StyledPagination,\r\n} from '../';\r\nimport { TextField, Box, Button } from '@mui/material';\r\nimport './VideoCollection.css';\r\n\r\nexport default function VideoCollection(props) {\r\n  const { \r\n    setBusy, \r\n    response, \r\n    pageNum, \r\n    handleChange, \r\n    modelModalState, \r\n    showDialog, \r\n    busy, \r\n    searchParam, \r\n    searchKey } =\r\n    useVideoCollection(props);\r\n  const { count, records } = response;\r\n  if (!records) return 'Loading...';\r\n  const totalPages = Math.ceil(count / 30);\r\n  return (\r\n    <Box  className=\"VideoCollection\">\r\n      <Box className=\"head\">\r\n        <Flex>\r\n          [{pageNum}][[{searchParam}]][{searchKey}][{response.searchKey}]\r\n          <StyledPagination\r\n            totalPages={totalPages}\r\n            page={pageNum}\r\n            handleChange={handleChange}\r\n          />\r\n          {!!busy && <em>loading...</em>}\r\n        </Flex>\r\n      </Box>\r\n      <Box className=\"App\">\r\n        <div className=\"ThumbnailGrid\">\r\n          {records?.map((video) => (\r\n            <VideoCard\r\n              key={video.ID}\r\n              video={video}\r\n              getModel={(q) => {\r\n                showDialog(q);\r\n              }}\r\n            />\r\n          ))}\r\n        </div>\r\n      </Box>\r\n      <Box className=\"head\">\r\n        <Flex>\r\n          <StyledPagination\r\n            totalPages={totalPages}\r\n            page={pageNum}\r\n            handleChange={handleChange}\r\n          />\r\n        </Flex>\r\n      </Box>\r\n      <ModelModal {...modelModalState} />\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction useVideoCollection({\r\n  collectionType,\r\n  searchParam,\r\n  pageNum,\r\n  onChange,\r\n  setBusy\r\n}) {\r\n  const { state, setState } = useComponentState({\r\n    page: 1,\r\n    param: searchParam,\r\n    type: collectionType,\r\n    response: {},\r\n    searchKey: `${collectionType}-${searchParam}-${pageNum}`\r\n  });\r\n  const { modelModalState, showDialog } = useModelModal();\r\n  const { page, response, busy, type, param, searchKey } = state;\r\n  \r\n  const createKey = () => [collectionType,searchParam,pageNum].filter(f => !!f).join('-');\r\n\r\n  const handleChange = (event, value) => {\r\n    const href = \r\n    onChange && onChange(value);\r\n  };\r\n  const loadVideos = React.useCallback(\r\n    async (p) => {\r\n      const items = await getVideos(p);\r\n      const searchKey$ = `video-${p}`;\r\n      console.log({ items });\r\n      setState('response', { ...items, searchKey: searchKey$ });\r\n      setState('page', p);\r\n      setState('searchKey', searchKey$);\r\n    },\r\n    [page]\r\n  );\r\n\r\n  const searchVideos = React.useCallback(\r\n    async (str, p) => {\r\n      const items = await findVideos(str, p);\r\n      const searchKey$ = `search-${str}-${p}`;\r\n      console.log({ items });\r\n      setState('response', { ...items , searchKey: searchKey$});\r\n      setState('page', p);\r\n      setState('param', str);\r\n      setState('searchKey', searchKey$);\r\n    },\r\n    [page]\r\n  );\r\n\r\n  const load = React.useCallback(\r\n    async (p, t) => {\r\n      setState('busy', !0);\r\n      setBusy(!0);\r\n      switch (collectionType) {\r\n        case 'search':\r\n          await searchVideos(searchParam, p);\r\n          break;\r\n        default:\r\n          await loadVideos(p);\r\n      }\r\n      setState('type', t);\r\n      setState('busy', !1);\r\n      setBusy(!1);\r\n    },\r\n    [collectionType]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    const renew = searchKey !== createKey();\r\n    console.log({pageNum, page,  searchKey}, [createKey(), response.searchKey, renew.toString()]);\r\n    (!!renew || !response.records) && load(pageNum, collectionType);\r\n  }, [response, pageNum, page, collectionType, type, param, searchParam]);\r\n\r\n  // const { count, records } = response;\r\n  // if (!records) return 'Loading...';\r\n  // const totalPages = Math.ceil(count / 30);\r\n  return {\r\n    response,\r\n    searchParam,\r\n    pageNum,\r\n    handleChange,\r\n    modelModalState,\r\n    showDialog,\r\n    busy,\r\n    setBusy,\r\n    searchKey\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}