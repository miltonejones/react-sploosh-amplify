{"ast":null,"code":"var _jsxFileName = \"/home/miltonejones/projects/react-sploosh-amplify/src/components/VideoCollection/VideoCollection.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from 'react';\nimport useComponentState from '../../hooks/useComponentState';\nimport { getVideos, getVideo, findVideos } from '../../connector/DbConnector';\nimport { VideoCard, ModelModal, useModelModal, Flex, StyledPagination } from '../';\nimport { TextField, Box, Button } from '@mui/material';\nimport './VideoCollection.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function VideoCollection(props) {\n  _s();\n\n  const {\n    setBusy,\n    response,\n    pageNum,\n    handleChange,\n    modelModalState,\n    showDialog,\n    busy,\n    searchParam,\n    searchKey\n  } = useVideoCollection(props);\n  const {\n    count,\n    records\n  } = response;\n  if (!records) return 'Loading...';\n  const totalPages = Math.ceil(count / 30);\n  return /*#__PURE__*/_jsxDEV(Box, {\n    className: \"VideoCollection\",\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      className: \"head\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        children: [\"[\", pageNum, \"][[\", searchParam, \"]]\", /*#__PURE__*/_jsxDEV(StyledPagination, {\n          totalPages: totalPages,\n          page: pageNum,\n          handleChange: handleChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 25,\n          columnNumber: 11\n        }, this), !!busy && /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 30,\n          columnNumber: 22\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 23,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: \"App\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ThumbnailGrid\",\n        children: records === null || records === void 0 ? void 0 : records.map(video => /*#__PURE__*/_jsxDEV(VideoCard, {\n          video: video,\n          getModel: q => {\n            showDialog(q);\n          }\n        }, video.ID, false, {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: \"head\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        children: /*#__PURE__*/_jsxDEV(StyledPagination, {\n          totalPages: totalPages,\n          page: pageNum,\n          handleChange: handleChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 48,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModelModal, { ...modelModalState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 21,\n    columnNumber: 5\n  }, this);\n}\n\n_s(VideoCollection, \"VjeiXv8P/4FQPfW0z1z+7muMPlo=\", false, function () {\n  return [useVideoCollection];\n});\n\n_c = VideoCollection;\n\nfunction useVideoCollection(_ref) {\n  _s2();\n\n  let {\n    collectionType,\n    searchParam,\n    pageNum,\n    onChange,\n    setBusy\n  } = _ref;\n  const {\n    state,\n    setState\n  } = useComponentState({\n    page: 1,\n    param: searchParam,\n    type: collectionType,\n    response: {}\n  });\n  const {\n    modelModalState,\n    showDialog\n  } = useModelModal();\n  const {\n    page,\n    response,\n    busy,\n    type,\n    param,\n    searchKey\n  } = state;\n\n  const handleChange = (event, value) => {\n    onChange && onChange(value);\n  };\n\n  const loadVideos = React.useCallback(async p => {\n    const items = await getVideos(p);\n    const searchKey$ = `video-${p}`;\n    console.log({\n      items\n    });\n    setState('response', { ...items,\n      searchKey: searchKey$\n    });\n    setState('page', p);\n    setState('searchKey', searchKey$);\n  }, [page]);\n  const searchVideos = React.useCallback(async (str, p) => {\n    const items = await findVideos(str, p);\n    const searchKey$ = `search-${str}-${p}`;\n    console.log({\n      items\n    });\n    setState('response', { ...items,\n      searchKey: searchKey$\n    });\n    setState('page', p);\n    setState('param', str);\n    setState('searchKey', searchKey$);\n  }, [page]);\n  const load = React.useCallback(async (p, t) => {\n    setState('busy', !0);\n    setBusy(!0);\n\n    switch (collectionType) {\n      case 'search':\n        await searchVideos(searchParam, p);\n        break;\n\n      default:\n        await loadVideos(p);\n    }\n\n    setState('type', t);\n    setState('busy', !1);\n    setBusy(!1);\n  }, [collectionType]);\n  React.useEffect(() => {\n    const renew = searchKey !== response.searchKey;\n    console.log([pageNum, page, renew.toString()]);\n    (!!renew || !response.records) && load(pageNum, collectionType);\n  }, [response, pageNum, page, collectionType, type, param, searchParam]); // const { count, records } = response;\n  // if (!records) return 'Loading...';\n  // const totalPages = Math.ceil(count / 30);\n\n  return {\n    response,\n    searchParam,\n    pageNum,\n    handleChange,\n    modelModalState,\n    showDialog,\n    busy,\n    setBusy,\n    searchKey\n  };\n}\n\n_s2(useVideoCollection, \"t/jbVDWJyZ7uUlkDgF5dGC82H5c=\", false, function () {\n  return [useComponentState, useModelModal];\n});\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoCollection\");","map":{"version":3,"sources":["/home/miltonejones/projects/react-sploosh-amplify/src/components/VideoCollection/VideoCollection.js"],"names":["React","useComponentState","getVideos","getVideo","findVideos","VideoCard","ModelModal","useModelModal","Flex","StyledPagination","TextField","Box","Button","VideoCollection","props","setBusy","response","pageNum","handleChange","modelModalState","showDialog","busy","searchParam","searchKey","useVideoCollection","count","records","totalPages","Math","ceil","map","video","q","ID","collectionType","onChange","state","setState","page","param","type","event","value","loadVideos","useCallback","p","items","searchKey$","console","log","searchVideos","str","load","t","useEffect","renew","toString"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport useComponentState from '../../hooks/useComponentState';\r\nimport { getVideos, getVideo, findVideos } from '../../connector/DbConnector';\r\nimport {\r\n  VideoCard,\r\n  ModelModal,\r\n  useModelModal,\r\n  Flex,\r\n  StyledPagination,\r\n} from '../';\r\nimport { TextField, Box, Button } from '@mui/material';\r\nimport './VideoCollection.css';\r\n\r\nexport default function VideoCollection(props) {\r\n  const { setBusy, response, pageNum, handleChange, modelModalState, showDialog, busy, searchParam, searchKey } =\r\n    useVideoCollection(props);\r\n  const { count, records } = response;\r\n  if (!records) return 'Loading...';\r\n  const totalPages = Math.ceil(count / 30);\r\n  return (\r\n    <Box  className=\"VideoCollection\">\r\n      <Box className=\"head\">\r\n        <Flex>\r\n          [{pageNum}][[{searchParam}]]\r\n          <StyledPagination\r\n            totalPages={totalPages}\r\n            page={pageNum}\r\n            handleChange={handleChange}\r\n          />\r\n          {!!busy && <em>loading...</em>}\r\n        </Flex>\r\n      </Box>\r\n      <Box className=\"App\">\r\n        <div className=\"ThumbnailGrid\">\r\n          {records?.map((video) => (\r\n            <VideoCard\r\n              key={video.ID}\r\n              video={video}\r\n              getModel={(q) => {\r\n                showDialog(q);\r\n              }}\r\n            />\r\n          ))}\r\n        </div>\r\n      </Box>\r\n      <Box className=\"head\">\r\n        <Flex>\r\n          <StyledPagination\r\n            totalPages={totalPages}\r\n            page={pageNum}\r\n            handleChange={handleChange}\r\n          />\r\n        </Flex>\r\n      </Box>\r\n      <ModelModal {...modelModalState} />\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction useVideoCollection({\r\n  collectionType,\r\n  searchParam,\r\n  pageNum,\r\n  onChange,\r\n  setBusy\r\n}) {\r\n  const { state, setState } = useComponentState({\r\n    page: 1,\r\n    param: searchParam,\r\n    type: collectionType,\r\n    response: {},\r\n  });\r\n  const { modelModalState, showDialog } = useModelModal();\r\n  const { page, response, busy, type, param, searchKey } = state;\r\n\r\n  const handleChange = (event, value) => {\r\n    onChange && onChange(value);\r\n  };\r\n  const loadVideos = React.useCallback(\r\n    async (p) => {\r\n      const items = await getVideos(p);\r\n      const searchKey$ = `video-${p}`;\r\n      console.log({ items });\r\n      setState('response', { ...items, searchKey: searchKey$ });\r\n      setState('page', p);\r\n      setState('searchKey', searchKey$);\r\n    },\r\n    [page]\r\n  );\r\n\r\n  const searchVideos = React.useCallback(\r\n    async (str, p) => {\r\n      const items = await findVideos(str, p);\r\n      const searchKey$ = `search-${str}-${p}`;\r\n      console.log({ items });\r\n      setState('response', { ...items , searchKey: searchKey$});\r\n      setState('page', p);\r\n      setState('param', str);\r\n      setState('searchKey', searchKey$);\r\n    },\r\n    [page]\r\n  );\r\n\r\n  const load = React.useCallback(\r\n    async (p, t) => {\r\n      setState('busy', !0);\r\n      setBusy(!0);\r\n      switch (collectionType) {\r\n        case 'search':\r\n          await searchVideos(searchParam, p);\r\n          break;\r\n        default:\r\n          await loadVideos(p);\r\n      }\r\n      setState('type', t);\r\n      setState('busy', !1);\r\n      setBusy(!1);\r\n    },\r\n    [collectionType]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    const renew = searchKey !== response.searchKey\r\n    console.log([pageNum, page, renew.toString()]);\r\n    (!!renew || !response.records) && load(pageNum, collectionType);\r\n  }, [response, pageNum, page, collectionType, type, param, searchParam]);\r\n\r\n  // const { count, records } = response;\r\n  // if (!records) return 'Loading...';\r\n  // const totalPages = Math.ceil(count / 30);\r\n  return {\r\n    response,\r\n    searchParam,\r\n    pageNum,\r\n    handleChange,\r\n    modelModalState,\r\n    showDialog,\r\n    busy,\r\n    setBusy,\r\n    searchKey\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}